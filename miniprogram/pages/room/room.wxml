<!--pages/room/room.wxml-->
<view class="container">
  <!-- è§„åˆ™æŒ‰é’® -->
  <view class="rules-btn" bindtap="showRules">
    <text>ğŸ“– è§„åˆ™</text>
  </view>

  <view class="header">
    <view class="room-info">
      <text class="room-id">æˆ¿é—´å·ï¼š{{roomId}}</text>
      <text class="player-count">{{currentPlayers}}/{{maxPlayers}}äºº</text>
    </view>
  </view>

  <view class="content">
    <!-- æœªåŠ å…¥æ—¶æ˜¾ç¤ºåŠ å…¥æŒ‰é’® -->
    <view wx:if="{{myPlayerNumber === 0}}" class="join-section">
      <button class="btn btn-primary" bindtap="joinRoom" loading="{{loading}}">
        åŠ å…¥æˆ¿é—´
      </button>
    </view>

    <!-- å·²åŠ å…¥ä½†æœªå‘ç‰Œ -->
    <view wx:elif="{{!gameStarted}}" class="waiting-section">
      <view class="my-info">
        <text class="label">ä½ çš„ç¼–å·ï¼š</text>
        <text class="value">{{myPlayerNumber}}</text>
      </view>

      <view class="players-list">
        <view class="player-item" wx:for="{{players}}" wx:key="player_number">
          <text class="player-number">{{item.player_number}}å·</text>
          <text class="player-name">{{item.nickname || 'ç©å®¶' + item.player_number}}</text>
        </view>
      </view>

      <view class="actions">
        <button
          wx:if="{{isCreator}}"
          class="btn btn-primary"
          bindtap="dealCards"
          loading="{{loading}}"
          disabled="{{currentPlayers < 3 || currentPlayers > 12}}"
        >
          å¼€å§‹æ¸¸æˆï¼ˆ{{currentPlayers < 3 ? 'éœ€' + (3 - currentPlayers) + 'äºº' : currentPlayers + 'äººæ¸¸æˆ'}}ï¼‰
        </button>
        <text wx:else class="waiting-text">ç­‰å¾…æˆ¿ä¸»å¼€å§‹æ¸¸æˆ...</text>

        <button class="btn btn-share" open-type="share">
          åˆ†äº«æˆ¿é—´
        </button>

        <button
          wx:if="{{isCreator}}"
          class="btn btn-secondary"
          bindtap="resetRoom"
        >
          é‡ç½®æˆ¿é—´
        </button>
      </view>
    </view>

    <!-- å·²å¼€å§‹æ¸¸æˆ -->
    <view wx:else class="result-section">
      <view class="game-started-tip">
        <text class="tip-icon">ğŸ®</text>
        <text class="tip-text">æ¸¸æˆå·²å¼€å§‹</text>
        <text class="tip-desc">è¯·æŸ¥çœ‹ä½ çš„è§’è‰²èº«ä»½</text>
      </view>

      <view class="actions">
        <button
          class="btn btn-primary"
          bindtap="goToRoleReveal"
        >
          æŸ¥çœ‹èº«ä»½
        </button>
      </view>
    </view>
  </view>

  <!-- è§„åˆ™å¼¹çª— -->
  <rules-modal show="{{showRulesModal}}" bind:close="hideRules"></rules-modal>
</view>
