# 桌游发牌助手 - 微信小程序（云开发版）

一个简单的微信小程序，用于和朋友一起玩桌游时随机分配字母。**使用微信云开发，完全不需要自己的服务器！**

## ✨ 功能特性

1. **创建房间**：支持5-10人的房间创建
2. **分享房间**：通过微信群分享房间链接，其他人可以快速加入
3. **自动编号**：进入房间的玩家自动获得编号（1号、2号...）
4. **随机发牌**：点击发牌后，每个玩家随机分配一个不重复的字母（A、B、C...）

## 🎯 为什么选择微信云开发？

✅ **完全不需要自己的服务器** - 微信提供云服务
✅ **微信小程序原生支持** - 集成方便，无需配置域名
✅ **有免费额度** - 朋友间玩完全够用
✅ **提供云数据库、云函数、云存储** - 一站式解决方案
✅ **自动扩容** - 无需担心服务器性能

## 📁 项目结构

```
card-dealer-miniprogram/
├── miniprogram/              # 微信小程序前端
│   ├── app.js               # 小程序入口（初始化云开发）
│   ├── app.json             # 小程序配置
│   ├── pages/               # 页面文件
│   │   ├── index/           # 首页（创建/加入房间）
│   │   ├── create/          # 创建房间页
│   │   └── room/            # 房间页（发牌）
│   └── cloudfunctions/      # 云函数目录
│       ├── createRoom/      # 创建房间云函数
│       ├── getRoomInfo/     # 获取房间信息云函数
│       ├── joinRoom/        # 加入房间云函数
│       ├── dealCards/       # 发牌云函数
│       └── resetRoom/       # 重置房间云函数
└── README.md                # 项目说明
```

## 🚀 快速开始

### 1. 注册小程序账号

1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 注册小程序账号
3. 获取 AppID

### 2. 开通云开发

1. 打开微信开发者工具
2. 创建小程序项目，填入你的 AppID
3. 点击顶部菜单 **云开发** -> **开通云开发**
4. 选择免费版（个人开发者完全够用）
5. 创建云环境，记录环境ID

### 3. 配置小程序

1. 修改 `miniprogram/app.js` 中的云环境ID：
```javascript
env: 'your-env-id', // 替换为你的云环境ID
```

2. 在微信开发者工具中：
   - 右键点击 `cloudfunctions` 文件夹
   - 选择 **上传并部署：云端安装依赖（不上传node_modules）**
   - 或者逐个上传每个云函数文件夹

### 4. 初始化云数据库

1. 打开微信开发者工具
2. 点击顶部菜单 **云开发** -> **云开发控制台**
3. 在左侧菜单选择 **数据库**
4. 创建两个集合：
   - `rooms` - 存储房间信息
   - `players` - 存储玩家信息

详细说明请查看 `miniprogram/database/init.md`

### 5. 上传云函数

在微信开发者工具中：

1. 右键点击 `cloudfunctions/createRoom` 文件夹
2. 选择 **上传并部署：云端安装依赖（不上传node_modules）**
3. 重复以上步骤，上传所有云函数：
   - `createRoom`
   - `getRoomInfo`
   - `joinRoom`
   - `dealCards`
   - `resetRoom`

### 6. 运行小程序

1. 在微信开发者工具中点击 **编译**
2. 测试创建房间、加入房间、发牌等功能

## 📖 使用流程

1. **创建房间**：打开小程序，点击"创建房间"，选择人数（5-10人）
2. **分享房间**：在房间页面点击"分享"按钮，分享到微信群
3. **加入房间**：其他人通过分享链接进入小程序，自动加入房间
4. **发牌**：当人数达到要求后，房主点击"发牌"按钮
5. **查看结果**：每个玩家会看到自己分配的字母，以及所有玩家的分配结果

## 🔧 云函数说明

### createRoom
创建房间，生成6位房间ID

**参数：**
```javascript
{
  max_players: 10  // 最大人数（5-10）
}
```

**返回：**
```javascript
{
  room_id: "ABC123",
  max_players: 10,
  message: "房间创建成功"
}
```

### getRoomInfo
获取房间信息和玩家列表

**参数：**
```javascript
{
  room_id: "ABC123"
}
```

**返回：**
```javascript
{
  room_id: "ABC123",
  max_players: 10,
  status: "waiting",
  current_players: 5,
  players: [...]
}
```

### joinRoom
加入房间，分配玩家编号

**参数：**
```javascript
{
  room_id: "ABC123",
  nickname: "玩家昵称"
}
```

**返回：**
```javascript
{
  player_number: 1,
  current_players: 5,
  max_players: 10
}
```

### dealCards
发牌，随机分配字母

**参数：**
```javascript
{
  room_id: "ABC123"
}
```

**返回：**
```javascript
{
  room_id: "ABC123",
  players: [
    { player_number: 1, nickname: "玩家1", letter: "A" },
    ...
  ]
}
```

### resetRoom
重置房间，清空所有玩家

**参数：**
```javascript
{
  room_id: "ABC123"
}
```

## 💰 免费额度说明

微信云开发免费版提供：

- **云函数调用量**：每月 100 万次
- **云数据库存储**：2GB
- **云数据库读操作**：每月 5 万次
- **云数据库写操作**：每月 3 万次
- **云存储容量**：5GB
- **CDN 流量**：5GB/月

对于朋友间使用，这些额度完全足够！

## ⚠️ 注意事项

1. **云环境ID**：必须在 `app.js` 中正确配置
2. **云函数部署**：需要逐个上传并部署云函数
3. **数据库集合**：必须创建 `rooms` 和 `players` 两个集合
4. **权限设置**：建议数据库权限设置为"仅创建者可读写，所有人可读"
5. **基础库版本**：需要 2.2.3 或以上版本支持云开发

## 🐛 常见问题

### Q: 云函数调用失败？
A: 检查云函数是否已上传并部署，检查云环境ID是否正确配置

### Q: 数据库操作失败？
A: 检查是否已创建 `rooms` 和 `players` 集合，检查数据库权限设置

### Q: 小程序无法打开？
A: 检查 AppID 是否正确，检查云开发是否已开通

## 📝 开发建议

如需生产环境使用，建议：
1. 添加房间密码功能
2. 添加房间过期清理机制（云函数定时触发器）
3. 优化错误处理和用户体验
4. 添加数据统计功能

## 📄 许可证

MIT License

## 🙏 感谢

使用微信云开发，让小程序开发变得更简单！
