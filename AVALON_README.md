# 阿瓦隆桌游助手小程序

一个完整的阿瓦隆桌游微信小程序，支持3-12人游戏，包含完整的游戏流程：角色分配、身份查看、队长轮换、提名、投票、任务执行、刺杀阶段等。

## ✨ 功能特性

### 🎮 完整游戏流程
- ✅ **角色分配**：支持3-12人，自动分配阿瓦隆角色
- ✅ **身份查看**：根据角色显示不同的身份信息
  - 梅林：看到所有坏人（除莫德雷德）
  - 派西维尔：看到梅林和莫甘娜（不知道谁是谁）
  - 坏人：互相认识（奥伯伦除外）
  - 奥伯伦：孤独的坏人
  - 忠臣：什么都看不到
- ✅ **队长轮换**：按顺序轮流担任队长
- ✅ **提名系统**：队长提名执行任务的玩家
- ✅ **投票机制**：所有人投票决定是否通过队伍
- ✅ **任务执行**：好人只能提交成功，坏人可以选择失败
- ✅ **刺杀阶段**：好人完成3次任务后，刺客刺杀梅林
- ✅ **规则说明**：任意页面可查看完整规则

### 🎯 角色配置
- 3人：梅林、忠臣 vs 刺客
- 4人：梅林、忠臣×2 vs 刺客
- 5人：梅林、派西维尔、忠臣 vs 莫甘娜、刺客
- 6人：梅林、派西维尔、忠臣×2 vs 莫甘娜、刺客
- 7人：梅林、派西维尔、忠臣×2 vs 莫甘娜、奥伯伦、刺客
- 8人：梅林、派西维尔、忠臣×3 vs 莫甘娜、莫德雷德、刺客、爪牙
- 9人：梅林、派西维尔、忠臣×4 vs 莫甘娜、莫德雷德、刺客、爪牙
- 10人：梅林、派西维尔、忠臣×4 vs 莫甘娜、莫德雷德、奥伯伦、刺客、爪牙
- 11人：梅林、派西维尔、忠臣×4 vs 莫甘娜、莫德雷德、奥伯伦、刺客、爪牙×2
- 12人：梅林、派西维尔、忠臣×4 vs 莫甘娜、莫德雷德、奥伯伦、刺客、爪牙×3

### 📊 任务配置
不同人数的任务执行人数自动配置，带*号任务需要两张失败票才算失败。

## 📁 项目结构

```
card-dealer-miniprogram/
├── miniprogram/
│   ├── app.js                      # 小程序入口
│   ├── app.json                    # 小程序配置
│   ├── utils/
│   │   ├── avalon-config.js        # 阿瓦隆角色配置
│   │   └── game-rules.js           # 游戏规则数据
│   ├── components/
│   │   └── rules-modal/            # 规则说明弹窗组件
│   ├── pages/
│   │   ├── index/                  # 首页（创建/加入房间）
│   │   ├── create/                 # 创建房间页
│   │   ├── room/                   # 房间等待页
│   │   ├── role-reveal/            # 身份查看页
│   │   ├── game/                   # 游戏主流程页
│   │   ├── mission/                # 任务执行页
│   │   └── assassinate/            # 刺杀阶段页
│   └── cloudfunctions/
│       ├── createRoom/             # 创建房间
│       ├── getRoomInfo/            # 获取房间信息
│       ├── joinRoom/               # 加入房间
│       ├── dealCards/              # 分配角色
│       ├── getPlayerRole/          # 获取玩家角色信息
│       ├── submitNomination/       # 提交提名
│       ├── submitVote/             # 提交投票
│       ├── submitMission/          # 提交任务结果
│       ├── assassinate/            # 刺杀
│       └── resetRoom/              # 重置房间
└── README.md
```

## 🚀 快速开始

### 1. 准备工作

1. 注册微信小程序账号（访问 https://mp.weixin.qq.com/）
2. 获取 AppID
3. 下载并安装微信开发者工具

### 2. 开通云开发

1. 打开微信开发者工具
2. 创建小程序项目，填入 AppID
3. 点击顶部菜单 **云开发** -> **开通云开发**
4. 选择 **免费版**
5. 创建云环境，记录 **环境ID**

### 3. 配置云环境ID

修改 `miniprogram/app.js` 中的云环境ID：

```javascript
wx.cloud.init({
  env: 'your-env-id', // 替换为你的云环境ID
  traceUser: true,
})
```

### 4. 创建数据库集合

在微信开发者工具中：

1. 点击 **云开发** -> **云开发控制台**
2. 选择 **数据库**
3. 创建以下集合：
   - `rooms` - 房间集合
   - `players` - 玩家集合

### 5. 上传云函数

在微信开发者工具中，右键点击每个云函数文件夹，选择 **上传并部署：云端安装依赖**：

- `createRoom` - 创建房间
- `getRoomInfo` - 获取房间信息
- `joinRoom` - 加入房间
- `dealCards` - 分配角色
- `getPlayerRole` - 获取玩家角色信息
- `submitNomination` - 提交提名
- `submitVote` - 提交投票
- `submitMission` - 提交任务结果
- `assassinate` - 刺杀
- `resetRoom` - 重置房间

### 6. 测试运行

1. 在微信开发者工具中点击 **编译**
2. 测试游戏流程

## 🎯 游戏流程

### 1. 创建房间
- 选择3-12人
- 系统自动生成房间号

### 2. 加入房间
- 输入房间号加入
- 或通过分享链接直接进入

### 3. 开始游戏
- 房主点击"开始游戏"
- 系统自动分配角色

### 4. 查看身份
- 每个玩家查看自己的角色
- 根据角色查看特殊信息

### 5. 游戏主流程
- **提名阶段**：队长提名执行任务的玩家
- **投票阶段**：所有人投票决定是否通过
- **任务执行**：被选中的玩家提交成功/失败
- 重复以上流程，直到一方获胜

### 6. 刺杀阶段
- 好人完成3次任务后
- 刺客指定一名玩家刺杀
- 若目标为梅林则坏人获胜，否则好人获胜

## 📖 胜利条件

### 好人获胜
- 完成三次任务 **且** 梅林未被刺客刺杀

### 坏人获胜
- 使三次任务失败
- **或** 最终刺杀梅林成功
- **或** 连续五次否决队伍

## 🎨 页面说明

### 首页 (index)
- 创建房间按钮
- 输入房间号加入
- 规则说明按钮

### 创建房间 (create)
- 选择3-12人
- 创建后自动加入房间

### 房间等待 (room)
- 显示房间号和当前人数
- 玩家列表
- 房主可以开始游戏
- 分享房间功能

### 身份查看 (role-reveal)
- 显示玩家角色
- 根据角色显示特殊信息
- 确认身份后进入游戏

### 游戏主流程 (game)
- 任务进度显示
- 当前队长提示
- 提名玩家界面
- 投票界面
- 连续否决警告

### 任务执行 (mission)
- 被选中的玩家提交成功/失败
- 好人只能选择成功
- 坏人可以选择失败

### 刺杀阶段 (assassinate)
- 刺客选择目标玩家
- 确认刺杀
- 显示游戏结果

## 🔧 技术栈

- **前端**：微信小程序原生开发
- **后端**：微信云开发（云函数 + 云数据库）
- **数据库**：微信云数据库
- **实时同步**：定时轮询更新

## 💡 使用建议

### 游戏建议
1. 建议3人以上游戏，人数越多越有趣
2. 首次游戏建议先阅读规则说明
3. 游戏过程中可随时查看规则
4. 保持手机屏幕隐私，避免其他玩家看到你的角色

### 技术建议
1. 使用体验版快速分享给朋友（无需审核）
2. 定期清理过期房间数据
3. 可以添加房间密码功能增强安全性
4. 可以添加游戏历史记录功能

## ⚠️ 注意事项

1. **云环境ID**：必须在 `app.js` 中正确配置
2. **云函数部署**：需要逐个上传并部署云函数
3. **数据库集合**：必须创建 `rooms` 和 `players` 两个集合
4. **人数限制**：支持3-12人游戏
5. **网络要求**：需要稳定的网络连接
6. **设备要求**：建议使用微信7.0.0以上版本

## 🐛 常见问题

### Q: 云函数调用失败？
A: 检查云函数是否已上传并部署，检查云环境ID是否正确配置

### Q: 角色分配失败？
A: 确保人数在3-12人之间，检查数据库权限设置

### Q: 投票/任务提交没反应？
A: 刷新页面或重新进入，检查网络连接

### Q: 刺杀阶段显示异常？
A: 确保所有云函数都已正确部署

## 📝 待优化功能

- [ ] 添加游戏历史记录
- [ ] 添加房间密码功能
- [ ] 添加角色自定义配置
- [ ] 添加游戏回放功能
- [ ] 优化实时同步机制（使用WebSocket）
- [ ] 添加音效和动画
- [ ] 添加排行榜功能

## 📄 许可证

MIT License

## 🙏 致谢

感谢微信云开发提供的便捷开发平台！

祝游戏愉快！🎮
